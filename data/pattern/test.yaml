scriptcompose_async:
  meta:
    discription: "Compose a comic strip with the given elements"
    memory: "default"
  data: Null
  callback: 
    split_story:
      args: 
        parsed_reply: ${scriptcompose.steps[0].meta.value_parsed}
      output:
        reply_callback: Null
      func: |
        parsed_reply = ${.args.parsed_reply}
        reply_callback = []
        for index in range(len(parsed_reply)-2):
          parsed = parsed_reply[index:index+3]
          reply_callback.append({"outline": "\n".join(parsed), "target": parsed_reply[index+1]})
    generate_script:
      args:
        parsed_reply: ${scriptcompose.steps[1].meta.value_parsed}
        table_head: Null
      output:
        reply_callback: Null
      func: |
        parsed_reply = ${.args.parsed_reply}
        reply_callback = table_head = "\n".join(parsed_reply[0].split("\n")[:2]) + "\n"
        print(table_head)
        for parsed in parsed_reply:
          reply_callback += parsed.replace(table_head, "") + "\n"
  steps:
    - name: "comic.split_story"
      meta: 
        value: |
          - {故事开始}
          - {高科技未来世界，夜幕下}{夜晚} 艾丽卡领导的黑客组织在虚拟现实的海洋中穿梭，进行数据转移。
          - {地点转换：虚拟现实→大公司的秘密数据库}{时间不变}
          - {大公司的秘密数据库}{夜晚} 艾丽卡意外发现大公司利用人工智能监控市场，剥削贫困人群。
          - {大公司的秘密数据库}{夜晚} 艾丽卡意外发现大公司利用人工智能监控市场，剥削贫困人群。
          - {故事结束}
        value_parsed: [
          '- {故事开始}', 
          '- {高科技未来世界，夜幕下}{夜晚} 艾丽卡领导的黑客组织在虚拟现实的海洋中穿梭，进行数据转移。', 
          '- {地点转换：虚拟现实→大公司的秘密数据库}{时间不变}', 
          '- {大公司的秘密数据库}{夜晚} 艾丽卡意外发现大公司利用人工智能监控市场，剥削贫困人群。',
          '- {故事结束}'
        ]
      add_to_memory: false
      agent: Null
      concurrent: False
      callback: "${scriptcompose.callback.split_story}"
    - name: "comic.generate_script"
      meta: Null
      add_to_memory: false
      agent: null
      concurrent: True
      callback: "${scriptcompose.callback.generate_script}"
      discription: "对拆分后的故事进行脚本生成"

#---------------------------------------

scriptcompose:
  meta:
    discription: "Compose a comic strip with the given elements"
    memory: "default"
  data: Null
  steps:
    - name: "comic.split_story"
      meta: 
        value_parsed: [
          '- {故事开始}', 
          '- {22世纪超级都市，夜晚} 霓虹灯光与摩天大楼交相辉映，机器人和人类和谐共处。', 
          '- {地点转换：超级都市→艾丽丝的公寓}{时间不变}', 
          '- {艾丽丝的公寓，夜晚} 27岁的天才黑客艾丽丝站在狭小却装备精良的公寓里，望着窗外的繁华景象，眼中闪过一丝坚定。', 
          '- {艾丽丝的公寓，夜晚} 艾丽丝目睹了太多不公，决定用技术手段为穷苦大众谋取利益。', 
          '- {艾丽丝的公寓，夜晚} 她的团队，由一群志同道合的黑客组成，他们利用自己的技术为底层人民发声。', 
          '- {艾丽丝的公寓，夜晚} 杰克，25岁，擅长数据分析，他的手指在键盘上飞快跳动。', 
          '- {艾丽丝的公寓，夜晚} 索菲，22岁，精通社交工程学，她的眼神锐利而深邃，总能洞察人心。', 
          '- {艾丽丝的公寓，夜晚} 他们成功地黑入了一个大型公司的系统，揭露了该公司的不法行为。', 
          '- {艾丽丝的公寓，夜晚} 为受害者争取到了赔偿，这一行动让他们名声大噪。', 
          '- {地点转换：艾丽丝的公寓→网络空间}{时间不变}', 
          '- {网络空间，夜晚} 随着名声的增长，他们遇到了一个强大的对手。', 
          '- {网络空间，夜晚} 他们发现这个对手正在策划一个对穷人不利的阴谋。', 
          '- {网络空间，夜晚} 黑客组织必须加快行动，阻止这个阴谋。', 
          '- {网络空间，夜晚} 在一场惊心动魄的网络对决中，他们利用杰克的数据分析和索菲的社交工程学。', 
          '- {网络空间，夜晚} 最终揭露了对手的真实身份和背后的黑幕。', 
          '- {网络空间，夜晚} 他们不仅成功地阻止了阴谋，还让公众意识到了贫富差距的严重性。', 
          '- {网络空间，夜晚} 引发了社会的广泛关注和改革。', 
          '- {地点转换：网络空间→艾丽丝的公寓}{时间转换：夜晚→清晨}', 
          '- {艾丽丝的公寓，清晨} 艾丽丝站在窗前，望着窗外逐渐苏醒的城市。', 
          '- {艾丽丝的公寓，清晨} 她知道这场战斗才刚刚开始。', 
          '- {故事结束}'
        ] 
      add_to_memory: false
      agent: null
      concurrent: False
      callback: Null
      discription: "对优化后的故事进行拆分"
    - name: "comic.generate_script"
      meta: Null
      add_to_memory: false
      agent: null
      concurrent: True
      callback: Null
      discription: "对拆分后的故事进行脚本生成"

scriptcompose_auto:
  meta:
    discription: "漫画脚本创作流程"
    memory: "default"
  steps:
    - name: "comic.generate_story"
      meta: 
        value: |
          {
            "名称": "太空冒险",
            "主题": "在一个充满未知和神秘的宇宙中，探索人类与外星文明之间的互动与冲突。",
            "角色": "艾莉亚是一位28岁的年轻女性指挥官，凭借在银河探险队中的杰出表现崭露头角，她曾在一场与外星海盗的战斗中拯救了全体船员。卡洛斯是35岁的资深工程师，拥有丰富的机械知识和战斗经验，曾在一次星际危机中修复了濒临爆炸的飞船。泽拉则是来自远古星系的神秘外星人，外表年轻却有300岁，拥有强大的心灵感应能力，正在寻找拯救自己濒危种族的方法。",
            "世界观": "故事发生在未来的23世纪，人类已经掌握了星际旅行的技术，宇宙中存在着多个星际联盟和独立的外星文明，银河系成为了探索与争夺的舞台。",
            "故事": {
              "叙事结构": "英雄旅程",
              "创作过程": "首先，设定主角艾莉亚的出发点，她接到一项任务去探索一个神秘的星系；接着，设计她在旅途中遇到的挑战，包括与外星海盗的冲突和星际联盟的政治阴谋；然后，安排她的成长与转变，通过与泽拉的相遇，理解宇宙更深层的联系；最后，构思她的归来，通过解决外星文明的危机，带来宇宙和平的新希望。",
              "情节内容": "艾莉亚接到命令，带领探险队前往一个未被探索的星系，调查一颗突然出现的神秘行星。在旅途中，他们遭遇了凶猛的外星海盗，经过一场激烈的战斗，他们成功脱险，并结识了神秘的外星人泽拉。泽拉请求他们帮助寻找一种古老的能量源，以拯救她的种族免于灭绝。艾莉亚和她的团队在泽拉的指引下，穿越了危险的星际空间，揭开了隐藏在行星深处的秘密。在这个过程中，艾莉亚逐渐意识到，宇宙中不同文明之间的平衡比她想象的更加脆弱。最终，她成功激活了能量源，不仅拯救了泽拉的种族，也带回了关于宇宙和谐的新知识，为人类和外星文明的未来开辟了新的道路。"
            }
          }
        value_parsed: "艾莉亚接到命令，带领探险队前往一个未被探索的星系，调查一颗突然出现的神秘行星。在旅途中，他们遭遇了凶猛的外星海盗，经过一场激烈的战斗，他们成功脱险，并结识了神秘的外星人泽拉。泽拉请求他们帮助寻找一种古老的能量源，以拯救她的种族免于灭绝。艾莉亚和她的团队在泽拉的指引下，穿越了危险的星际空间，揭开了隐藏在行星深处的秘密。在这个过程中，艾莉亚逐渐意识到，宇宙中不同文明之间的平衡比她想象的更加脆弱。最终，她成功激活了能量源，不仅拯救了泽拉的种族，也带回了关于宇宙和谐的新知识，为人类和外星文明的未来开辟了新的道路。"
      add_to_memory: false
      agent: null
      concurrent: False
      callback: Null
      discription: "对给定信息进行漫画要素补全"
    - name: "comic.split_story"
      meta: 
        value: |
          ```markdown
          - {银河系-地球指挥中心}{故事开始}
          - {银河系-地球指挥中心}{白天} 艾莉亚接到命令，准备前往未被探索的星系。
          - {地点转换：地球指挥中心→探险飞船}{时间转换：白天→夜晚}
          - {探险飞船-舰桥}{夜晚} 艾莉亚带领探险队出发，开始星际旅程。
          - {地点转换：探险飞船→太空}{时间转换：夜晚→白天}
          - {太空-未知星系}{白天} 探险队抵达神秘星系，发现神秘行星。
          - {太空-未知星系}{白天} 遭遇外星海盗，展开激烈战斗。
          - {地点转换：太空→探险飞船}{时间转换：白天→夜晚}
          - {探险飞船-舰桥}{夜晚} 探险队成功脱险，结识外星人泽拉。
          - {地点转换：探险飞船→神秘行星}{时间转换：夜晚→白天}
          - {神秘行星-地表}{白天} 在泽拉的指引下，寻找古老能量源。
          - {神秘行星-地下遗迹}{白天} 艾莉亚揭开行星深处的秘密。
          - {地点转换：神秘行星→探险飞船}{时间转换：白天→夜晚}
          - {探险飞船-舰桥}{夜晚} 艾莉亚意识到宇宙文明的脆弱平衡。
          - {地点转换：探险飞船→太空}{时间转换：夜晚→白天}
          - {太空-未知星系}{白天} 艾莉亚成功激活能量源。
          - {地点转换：太空→地球指挥中心}{时间转换：白天→晚上}
          - {银河系-地球指挥中心}{晚上} 艾莉亚带回宇宙和谐的新知识。
          - {银河系-地球指挥中心}{故事结束}
          ```
        value_parsed: Null
      add_to_memory: false
      agent: null
      concurrent: False
      callback: Null
      discription: "对优化后的故事进行拆分"
    - name: "comic.generate_script"
      meta: 
        value: |
          ```markdown
          | 类别 | 内容描述 | 场景 | 景别 | 角度 | 声音 | 后期效果 | 分格大小 |
          | ---- | -------- | --- | --- | ---- | ---- | -------- | -------- |
          | 主分镜 | 艾莉亚接到命令，准备前往未被探索的星系。 | 地球指挥中心 | 中景 | 正面 | 人物对话 | 无 | 大 |
          | 过渡分镜 | 艾莉亚从地球指挥中心前往探险飞船。 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 中 |
          | 主分镜 | 艾莉亚带领探险队出发，开始星际旅程。 | 探险飞船-舰桥 | 远景 | 俯视 | 环境音：引擎声 | 无 | 大 |
          | 过渡分镜 | 探险队从飞船进入未知星系。 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 中 |
          | 主分镜 | 探险队抵达神秘星系，发现神秘行星。 | 太空-未知星系 | 全景 | 远景 | 环境音：宇宙背景音 | 无 | 大 |
          | 主分镜 | 遭遇外星海盗，展开激烈战斗。 | 太空-未知星系 | 动态镜头 | 各种角度 | 战斗音效 | 运动模糊、速度线 | 大 |
          | 过渡分镜 | 探险队从太空返回探险飞船。 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 中 |
          | 主分镜 | 探险队成功脱险，结识外星人泽拉。 | 探险飞船-舰桥 | 中景 | 正面 | 人物对话 | 无 | 大 |
          | 过渡分镜 | 从探险飞船前往神秘行星。 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 中 |
          | 主分镜 | 在泽拉的指引下，寻找古老能量源。 | 神秘行星-地表 | 远景 | 俯视 | 环境音：风声 | 无 | 大 |
          | 主分镜 | 艾莉亚揭开行星深处的秘密。 | 神秘行星-地下遗迹 | 中景 | 侧面 | 环境音：遗迹回声 | 光影效果 | 大 |
          | 过渡分镜 | 从神秘行星返回探险飞船。 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 中 |
          | 主分镜 | 艾莉亚意识到宇宙文明的脆弱平衡。 | 探险飞船-舰桥 | 近景 | 正面 | 内心独白 | 无 | 大 |
          | 过渡分镜 | 从探险飞船进入太空。 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 中 |
          | 主分镜 | 艾莉亚成功激活能量源。 | 太空-未知星系 | 全景 | 远景 | 能量涌动声 | 光芒效果 | 大 |
          | 过渡分镜 | 从太空返回地球指挥中心。 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 该字段不适用 | 中 |
          | 主分镜 | 艾莉亚带回宇宙和谐的新知识。 | 地球指挥中心 | 中景 | 正面 | 人物对话 | 无 | 大 |

          ```
        value_parsed: Null
      add_to_memory: false
      agent: null
      concurrent: True
      callback: Null
      discription: "对拆分后的故事进行脚本生成"